<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=windows-1252">
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
      <script type="text/javascript">

		window.binary = "DJRkAAyU\/AMMlCkEDJSMAAyUjAAMlIwADJSMAAyUoAMMlIwADJSMAAyUjAAMlIwADJSMAAyUjAAMlIwADJSMAAyUVgQMlIwADJS7AAyUCQEMlIwADJSMAAyUjAAMlIwADJSMAAyUjAACAAAAACQAJwAqAAAAAAAlACgAKwAAAAAAIwAmACkABAQEBAQEBAQCAgICAgIDAwMDAwMBAgQIECBAgAECBAgQIAECBAgQIAAAAAcAAgEAAAMEBgAAAAAAAAAAAO4BRAIRJB++z+\/Y4N6\/zb8R4KDgseDs4fzgAsAFkA2SqDGxB9n3EeCo4bHgAcAdkqw9sQfh9xDgyOzQ4ATAIpf+AQ6UCAbEPNEHyfcOlKsADJSOAAyUAAD4lAyUDAaN4GHgDpRxBWjuc+CA4JDgDpSeBI3gYOAOlHEFaO5z4IDgkOAOlJ4ECJWN4GHgDpQyBQiVz5Pfkw6U9wQOlKYAxu\/Q4A6UkQAgl+HzDpT2APnPCJUfkg+SD7YPkhEkL5M\/k0+Tj5Ofk++T\/5OAkcAAgv0dwECRxgAgkVgBMJFZAS9fP08vczBwgJFaAZCRWwEoFzkHcfDgkVgB8JFZAehe\/k9AgzCTWQEgk1gBAsCAkcYA\/5HvkZ+Rj5FPkT+RL5EPkA++D5AfkBiV4JGsAfCRrQHgXP9PgZGRkSCBMYGCG5MLj3OQcIkrEfAOlLoACJUfkg+SD7YPkhEkL5M\/k4+Tn5Pvk\/+TIJGcATCRnQGAkZ4BkJGfASgXOQcx9ICRwQCPfYCTwQAUwOCRngHwkZ8B5Fr+TyCBgJGeAZCRnwEBlo9zkHCQk58BgJOeASCTxgD\/ke+Rn5GPkT+RL5EPkA++D5AfkBiV3AEclu2R\/JEdl+Bc\/08hkTGRgIGRgSgbOQsvczBwyQEIldwBHJbtkfyRHZfgXP9PIIExgeBU8EDfAa5bv0+NkZyREZcoFzkHGfQv7z\/vB8CNkZyR6A\/5H4CBKC8w4MkBCJXcARyW7ZH8kR2X4Fz\/TyCBMYHgVPBA3wGuW79PjZGckRGXKBc5Bxn0L+8\/7xDAjZGckRGX6A\/5HyCBjZGckRGXAZaPc5BwEZack46TMODJAQiV3AGRloyRkZeIIznwVJbtkfyRVZeAgYb\/+c+RlhySCJXPk9+T7AHuhf+F4Fz\/TyCBMYHgVPBAL18\/Ty9zMHDfAa5bv0+NkZyREZcoFzkH0fPgXP9PgIGRgeBU8EDoD\/kfYIPuhf+F4Fz\/TzGDIIPuif+JIIGB4JDgD4wCwIgPmR8KlOL3KCsgg4HgiaPsif2JgIGAZICDgeCQ4N+Rz5EIlRCSowEQkqIBiO6T4KDgsOCAk6QBkJOlAaCTpgGwk6cBheCR4JCToQGAk6ABiOGR4JCTrQGAk6wBjOWR4JCTrwGAk64BheyQ4JCTsQGAk7ABhOyQ4JCTswGAk7IBgOyQ4JCTtQGAk7QBgeyQ4JCTtwGAk7YBguyQ4JCTuQGAk7gBhuyQ4JCTuwGAk7oBhOCAk7wBg+CAk70Bh+CAk74BheCAk78BgeCAk8ABCJWF4ZHgkJPDAYCTwgEQksQBEJLFARCSxgEQkscBCJWPkp+Sr5K\/ks+S35Lvkv+SD5Mfk8+T35NMAWsBfAGqJLskwODQ4MYB9wFigUrgUOAOlFYDjAHGAW7iDpS\/AggPGR+gDrEeIZYIlOEc8RzDMNEFSffGAfQBZYFK4FDgDpRWA5UBKA85H8kB35HPkR+RD5H\/kO+Q35DPkL+Qr5CfkI+QCJXPkt+S75L\/kg+TH5PPk9+TfAFrAYoBwODQ4A\/A1gFtkW0B1wHtkfyRAZDwgeAtxwEJlcgP2R8BUBBAARURBXH3zgHfkc+RH5EPkf+Q75DfkM+QCJXcAe2R\/JEBkPCB4C0JlQiVz5Pfk+wBYRVxBRn0IOAw4A\/A2wENkAAg6fcRl6YbtwvogfmBAoDzgeAtrQEJlZwByQHfkc+RCJVPkl+Sf5KPkp+Sr5K\/ks+S35Lvkv+SD5Mfk9+Tz5PNt963oZcPtviU3r8Pvs2\/LAF0LssBIjAI9CrgGaIx4sMu0SzMDt0egi6ZJKokuyRnLXUvpQGUAQ6U5AV5AYoByAG3AaUBlAEOlMUFRy1GGwiUwQjRCEowFPRAXQHASVz2AUCD4RTxBAEFEQUh8H4sXy3IAd3PwgG2AQ6UxwKhlg+2+JTevw++zb\/Pkd+RH5EPkf+Q75DfkM+Qv5CvkJ+Qj5B\/kF+QT5AIldwBIRUxBUH07ZH8kQGQ8IHgLWQvCZUIlQ6U4wIIle+S\/5IPkx+TmgHmLv8kAOAQ4LgBpwEOlEcDH5EPkf+Q75AIlYEwQfCBMBjwgjDR9AnAEJJuAAiVgJFvAI1\/gJNvAAiVgJFwAI1\/gJNwAIHggJOwAICRsQCIf4RggJOxABCSswAIlR+TGC+AkQABgRcR8J\/vBsDo5vDglJGP74CTAAGJLw6UaAOBL2DgDpRxBR+RCJUfkg+SD7YPkhEkL5M\/k0+TX5Nvk3+Tj5Ofk6+Tv5Pvk\/+TgJHIAZCRyQGgkcoBsJHLAQCXoQWxBVHx4JHMAfCRzQGAgZCRzgGJJ4CDgJHIAZCRyQGgkcoBsJHLARgWGQYaBhsGxPSAkcgBkJHJAaCRygGwkcsBAZehCbEJgJPIAZCTyQGgk8oBsJPLAQTAgJEAAQ6UiQP\/ke+Rv5GvkZ+Rj5F\/kW+RX5FPkT+RL5EPkA++D5AfkBiVH5IPkg+2D5IRJC+TP5NPk1+Tb5N\/k4+Tn5Ovk7+T75P\/k4CRzwGQkdABiSsp8OCRzwHwkdABCZX\/ke+Rv5GvkZ+Rj5F\/kW+RX5FPkT+RL5EPkA++D5AfkBiVH5IPkg+2D5IRJC+TP5NPk1+Tb5N\/k4+Tn5Ovk7+T75P\/k4CR0QGQkdIBiSsp8OCR0QHwkdIBCZX\/ke+Rv5GvkZ+Rj5F\/kW+RX5FPkT+RL5EPkA++D5AfkBiVH5IPkg+2D5IRJC+TP5OPk5+Tr5O\/k4CR1wGQkdgBoJHZAbCR2gEwkdsBAZahHbEdIy8tXy03IPAtVwGWoR2xHSCT2wGAk9cBkJPYAaCT2QGwk9oBgJHTAZCR1AGgkdUBsJHWAQGWoR2xHYCT0wGQk9QBoJPVAbCT1gG\/ka+Rn5GPkT+RL5EPkA++D5AfkBiVmwGsAX+3+JSAkdMBkJHUAaCR1QGwkdYBZrWomwXAbz8Z8AGWoR2xHX+\/ui+pL5gviCeGD5EdoR2xHWLgiA+ZH6ofux9qldH3vAEtwP+3+JSAkdMBkJHUAaCR1QGwkdYB5rWomwXA7z8Z8AGWoR2xHf+\/ui+pL5gviCeOD5EdoR2xHeLgiA+ZH6ofux\/qldH3hhuXC4hek0DI8iFQMEBAQFBAaFF8TyEVMQVBBVEFcfYIlXiUhLWCYIS9hLWBYIS9hbWCYIW9hbWBYIW97ubw4ICBgWCAg+Ho8OAQgoCBgmCAg4CBgWCAg+Do8OCAgYFggIPh6\/DggIGEYICD4Ovw4ICBgWCAg+rn8OCAgYRggIOAgYJggIOAgYFggIOAgYBogIMQksEACJXPk9+TSC9Q4MoBhVafT\/wBNJFJV19P+gGEkYgjafGQ4IgPmR\/8AedZ\/0+lkbSR\/AHtWP9PxZHUkWYjUfQvt\/iUjJGTL5CViSOMk4iBiSMLwGIwYfQvt\/iUjJGTL5CViSOMk4iBgyuIgy+\/BsCft\/iUjJGDK4yTn7\/fkc+RCJVIL1DgygGBVZ9P\/AEkkcoBhVafT\/wBlJFJV19P+gE0kTMjCfRAwCIjUfEjMHHwJDAo9CEwofAiMBH1FMAmMLHwJzDB8CQw2fQEwICRgACPdwPAgJGAAI99gJOAABDAhLWPdwLAhLWPfYS9CcCAkbAAj3cDwICRsACPfYCTsADjL\/Dg7g\/\/H+1Y\/0+lkbSRL7f4lGYjIfSMkZCViSMCwIyRiSuMky+\/CJVin9ABc5\/wAYKf4A3xHWSf4A3xHZKf8A2Dn\/ANdJ\/wDWWf8A2ZJ3KfsA3hHfkfY5+wDeEd+R+9Ac8BESQIlaHiGi6qG7sb\/QENwKofux\/uH\/8fohezB+QH9Qcg8KIbswvkC\/ULZh93H4gfmR8alGn3YJVwlYCVkJWbAawBvQHPAQiV7g\/\/HwWQ9JHgLQmU+JT\/z\/8AAAAArgGVAkQBdQFVAZ4BAAAAAFMCAA==";

         var sock = null;
         var wsuri = "ws://localhost:9000";
		 var sock2 = null;
         var wsuri2 = "ws://localhost:9001";

		 window.oldPorts = "";

         window.onload = function() {

            sock = new WebSocket(wsuri);

            sock.onopen = function() {
               console.log("connected to " + wsuri);
				version();

				window.setInterval( function(){sock.send(JSON.stringify({"type":"ack"}));}, 500);
            }

            sock.onclose = function(e) {
               console.log("connection closed (" + e.code + ")");
            }

            sock.onmessage = function(e) {
               console.log("message received: " + e.data);
				var data = JSON.parse(e.data);
				if(data["type"] == "ports")
				{
					if(JSON.stringify(oldPorts) != JSON.stringify(data["ports"]))
					{
						$('#serial_select').find('option').remove();
						for (var i = 0; i < data["ports"].length; i++) 
						{
							if (data["ports"][i] != "")
							{
						    	serial_select.options[i] = new Option(data["ports"][i], data["ports"][i], true, false);
						    }
						}
						oldPorts = data["ports"];
					}
				}
				else if(data["type"] == "version")
				{
					document.getElementById('daemon_version').innerHTML = data["version"];
				}
				else if(data["type"] == "check_drivers")
				{
					if(data["installed"])
						document.getElementById('drivers').innerHTML = "INSTALLED";
					else
					document.getElementById('drivers').innerHTML = "NOT INSTALLED";
				}
            }

            window.sock2 = new WebSocket(wsuri2);

            sock2.onopen = function() {
               console.log("connected to " + wsuri2);
				window.setInterval( function() {sock2.send(JSON.stringify({"type":"ack"}));}, 500);
            }

            sock2.onclose = function(e) {
               console.log("connection closed (" + e.code + ")");
            }

            sock2.onmessage = function(e) {
               console.log("message received: " + e.data);
				var data = JSON.parse(e.data);
				if(data["type"] == "data")
				{
					$("#serialmon").html($("#serialmon").html() + data["data"]);
				}
            }


         };

         function send() {
            var msg = {"type":"message","text":document.getElementById('message').value};
            sock.send(JSON.stringify(msg));
         };

         function flash() {
            var msg = {"type":"flash","binary":window.binary, "cpu":"atmega328p", "ptc":"arduino", "prt":serial_select.selectedOptions[0].text, "bad":"115200"};
            sock.send(JSON.stringify(msg));
         };

         function version() {
            var msg = {"type":"version"};
            sock.send(JSON.stringify(msg));
         };

		function checkDrivers()
		{
            var msg = {"type":"check_drivers"};
            sock.send(JSON.stringify(msg));
		};

		function installDrivers()
		{
            var msg = {"type":"install_drivers"};
            sock.send(JSON.stringify(msg));
		};

        function connect() {
           var msg = {"type":"serial_connect","port":serial_select.selectedOptions[0].text, "baudrate":serial_baud.selectedOptions[0].text};
           sock2.send(JSON.stringify(msg));
        };

        function disconnect() {
           var msg = {"type":"serial_disconnect",};
           sock2.send(JSON.stringify(msg));
        };

        function sendData() {
           var msg = {"type":"data","data":document.getElementById('message').value};
           sock2.send(JSON.stringify(msg));
        };
      </script>
   </head>
   <body>
      <h1>WebSocket Echo Test</h1>
      <form>
		<p>
			WebSocket Daemon Version: <span id="daemon_version">Unknown</span> <span id="drivers"></span>
		</p>
         <p>
            Message: <input id="message" value="Hello, world!" type="text">
         </p>
      </form>
      <button onclick="send();">Send Message</button>
      <button onclick="flash();">Flash</button>
      <button onclick="version();">Version</button>
      <button onclick="checkDrivers();">Check Drivers</button>
      <button onclick="installDrivers();">Install Drivers</button>
	<select id="serial_select" style="width:300px"></select>

	<br />
	  <button onclick="connect();">Connect</button>
      <button onclick="disconnect();">Disconnect</button>
      <button onclick="sendData();">Send Message</button>
	<select id="serial_baud" style="width:300px"><option id="9600" name=9600>9600</option></select>
	<pre id="serialmon" style="display: block; border: 1px solid; width:500px; height: 800px; overflow-y: scroll">WebSerial Monitor Input:</pre>
   

</body></html>
